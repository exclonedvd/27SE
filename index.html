<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Accesso Antares II</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Accesso all'app 27° Corso Sergenti Antares II – Riassunti & Quiz." />
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="img/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="img/icon-192.png">
    <style>
  :root{
    /* Palette allineata ad app.html */
    --bg1:#050607;
    --bg2:#111317;
    --ac1:#c92b2b;
    --ac2:#ffcc66;
    --glass: rgba(255,255,255,.06);
    --glass-strong: rgba(255,255,255,.14);
    --txt:#f5f5f5;
    --muted:#a0a4b0;
    --vh: 1vh;

    /* alias compatibili col vecchio index */
    --bg-color: var(--bg1);
    --card-bg: rgba(10,14,32,.96);
    --accent: var(--ac1);
    --accent-soft: var(--ac2);
    --text-main: var(--txt);
    --text-muted: var(--muted);
    --border-subtle: rgba(255,255,255,0.08);
  }

  @supports (height: 1dvh){
    :root{ --vh:1dvh; }
  }

  *{ box-sizing:border-box; }

  html,body{ height:100%; }

  body{
    margin:0;
    min-height:calc(var(--vh) * 100);
    font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    color:var(--txt);
    background: radial-gradient(circle at top, #202635 0, #050607 55%);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px 16px;
    position:relative;
    overflow:hidden;
  }

  /* “aurora” come in app.html, ma con pseudo-elemento */
  body::before{
    content:"";
    position:fixed;
    inset:-50% -20% -20% -20%;
    pointer-events:none;
    filter:blur(60px);
    opacity:.4;
    mix-blend-mode:screen;
    background: conic-gradient(from 180deg at 50% 50%, #c92b2b 0deg, #ffcc66 120deg, #c92b2b 240deg, #c92b2b 360deg);
    animation: spin 30s linear infinite;
    z-index:0;
  }

  @keyframes spin{ to{ transform:rotate(360deg); } }

  main.card{
    width:100%;
    max-width:420px;
    padding:24px 20px 26px;
    background: linear-gradient(180deg, rgba(10,14,32,.96), rgba(10,14,32,.9));
    border-radius:20px;
    border:1px solid #ffffff1a;
    box-shadow:0 18px 45px rgba(0,0,0,.85);
    position:relative;
    z-index:1;
  }

  .logo-wrapper{
    display:flex;
    justify-content:center;
    margin-bottom:18px;
  }

  .logo-circle{
    width:72px;
    height:72px;
    border-radius:50%;
    background: radial-gradient(circle at top, #ffffff22, #c92b2b44);
    display:grid;
    place-items:center;
    border:1px solid #ffffff33;
    box-shadow:0 10px 30px rgba(0,0,0,.7);
    overflow:hidden;
  }

  .logo-circle img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .title{
    text-align:center;
    margin-bottom:4px;
    letter-spacing:0.22em;
    text-transform:uppercase;
    font-size:.8rem;
    color:var(--muted);
  }

  .subtitle{
    text-align:center;
    font-size:1.05rem;
    font-weight:700;
    margin-bottom:18px;
  }

  .subtitle span{
    color:var(--ac2);
    text-shadow:0 0 10px rgba(201,43,43,.55);
  }

  .description{
    text-align:center;
    font-size:.86rem;
    color:var(--muted);
    margin-bottom:22px;
  }

  .field-group{
    margin-bottom:14px;
  }

  .field-label{
    font-size:.8rem;
    font-weight:600;
    letter-spacing:.08em;
    text-transform:uppercase;
    color:#c8d3f3;
    margin-bottom:4px;
    display:block;
  }

  .input-wrapper{
    position:relative;
  }

  input[type="text"],
  input[type="password"]{
    width:100%;
    padding:11px 12px;
    border-radius:11px;
    border:1px solid #ffffff24;
    background:#0f1731;
    color:var(--txt);
    font-size:.9rem;
  }

  input::placeholder{
    color:#98a1c2;
  }

  input:focus{
    outline:none;
    border-color:#9acbff;
    box-shadow:0 0 0 1px #9acbff55;
  }

  .eye{
    position:absolute;
    right:10px;
    top:50%;
    transform:translateY(-50%);
    font-size:.7rem;
    font-weight:600;
    letter-spacing:.09em;
    text-transform:uppercase;
    border:none;
    background:transparent;
    color:var(--muted);
    cursor:pointer;
    user-select:none;
  }

  button{
    width:100%;
    padding:12px 14px;
    border-radius:999px;
    border:1px solid #ffffff22;
    font-size:.9rem;
    font-weight:700;
    letter-spacing:.12em;
    text-transform:uppercase;
    cursor:pointer;
    background:linear-gradient(180deg,#ffffff18,#ffffff0b);
    color:var(--txt);
    box-shadow:0 10px 26px rgba(0,0,0,.7);
    transition: transform .12s ease, box-shadow .12s ease, background .2s;
  }

  button:hover{
    transform:translateY(-1px);
    box-shadow:0 14px 32px rgba(0,0,0,.8);
    background:linear-gradient(180deg,#75e6ff40,#7c6bff30);
  }

  button:active{
    transform:translateY(0);
    box-shadow:0 8px 18px rgba(0,0,0,.7);
  }

  .btn-patch{
    margin-top:8px;
    border-color:#ffffff33;
  }

  .btn-install{
    margin-top:8px;
    background:transparent;
    border-style:dashed;
    border-color:#ffcc6680;
    color:var(--ac2);
    box-shadow:none;
    font-size:.78rem;
  }

  .error{
    margin-top:10px;
    font-size:.8rem;
    color:#f97373;
    min-height:1em;
  }

  .footer{
    margin-top:16px;
    padding-top:10px;
    border-top:1px solid #ffffff1a;
    font-size:.75rem;
    color:var(--muted);
    display:flex;
    align-items:center;
    gap:8px;
  }

  .accent-dot{
    width:7px;
    height:7px;
    border-radius:50%;
    background:radial-gradient(circle at center,#ffcc66,#c92b2b);
    box-shadow:0 0 8px rgba(201,43,43,.9);
  }

  @media (max-width:480px){
    main.card{
      padding:20px 16px 22px;
      border-radius:18px;
    }
  }
</style>

</head>
<body>
  <main class="card">
    <div class="logo-wrapper">
      <div class="logo-circle">
        <img src="logo-antares.png" alt="Antares II - 27° Corso Sergenti Aeronautica Militare" />
      </div>
    </div>

    <div class="title">27° Corso Sergenti</div>
    <div class="subtitle">
      Aeronautica Militare · <span>Antares II</span>
    </div>

    <p class="description">
      Accesso esclusivo tramite <strong>username</strong> e <strong>password</strong>.
    </p>

    <div class="field-group">
      <label class="field-label" for="matricola">Username</label>
      <input
        id="matricola"
        type="text"
        inputmode="text"
        placeholder="Nome.Cognome"
        autocomplete="off"
      />
    </div>

    <div class="field-group">
      <label class="field-label" for="password">Password</label>
      <div class="input-wrapper">
        <input
          id="password"
          type="password"
          placeholder="Inserisci la password"
          autocomplete="off"
        />
        <span class="eye" id="toggleEye">MOSTRA</span>
      </div>
    </div>

    
    <button type="button" onclick="login()">Accedi</button>

    <button
      type="button"
      onclick="window.location.href='https://27se.pages.dev/register'"
      style="margin-top:8px;"
    >
      Registrati
    </button>

    <button type="button" id="patchBtn" class="btn-patch">
      PATCH CORSO
    </button>
    <button type="button" id="installBtn" class="btn-install" style="margin-top:8px;">
      Installa l'app ANTARES II
    </button>

    <button type="button" id="installBtn" class="btn-install" style="display:none;margin-top:8px;">
      Installa l'app ANTARES II Antares II
    </button>
    <div id="errore" class="error"></div>

    <div class="footer">
      <span class="accent-dot"></span>
      Accesso controllato
    </div>
  </main>

  <script src="utenti.js"></script>

  <script>
    function login() {
      const matInput = document.getElementById("matricola");
      const passInput = document.getElementById("password");
      const errore = document.getElementById("errore");

      const matricola = matInput.value.trim();
      const password = passInput.value.trim();

      if (!matricola || !password) {
        errore.textContent = "Inserisci matricola e password.";
        return;
      }

      const passwordAttesa = UTENTI[matricola];

      if (!passwordAttesa || passwordAttesa !== password) {
        errore.textContent = "Credenziali non valide.";
        return;
      }

      try {
        sessionStorage.setItem("loggedIn", "1");
        sessionStorage.setItem("matricola", matricola);
      } catch (e) {
        console.warn("Impossibile usare sessionStorage", e);
      }

      errore.textContent = "";
      window.location.href = "app.html";
    }

    // Gestore per il bottone PATCH CORSO
    (function() {
      const FILE_NAME = "Patch.jpg";
      const FILE_PATH = FILE_NAME;
      const btnPatch = document.getElementById("patchBtn");
      if (!btnPatch) return;

      btnPatch.addEventListener("click", async () => {
        try {
          const res = await fetch(FILE_PATH);
          if (!res.ok) throw new Error("Download fallito");
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = FILE_NAME;
          document.body.appendChild(a);
          a.click();
          a.remove();
          setTimeout(() => URL.revokeObjectURL(url), 3000);
        } catch (err) {
          window.open(FILE_PATH, "_blank");
        }
      }, { passive: true });
    })();


    document.getElementById("matricola").addEventListener("keypress", function (e) {
      if (e.key === "Enter") login();
    });
    document.getElementById("password").addEventListener("keypress", function (e) {
      if (e.key === "Enter") login();
    });

    const toggleEye = document.getElementById("toggleEye");
    const inputPassword = document.getElementById("password");

    toggleEye.addEventListener("click", () => {
      const isPassword = inputPassword.type === "password";
      inputPassword.type = isPassword ? "text" : "password";
      toggleEye.textContent = isPassword ? "NASCONDI" : "MOSTRA";
    });

    // --- PWA install handling ---
    let deferredPrompt = null;
    const installBtn = document.getElementById("installBtn");

    // Android / Chrome / Edge: beforeinstallprompt
    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (installBtn) {
        installBtn.style.display = "block";
      }
    });

    if (installBtn) {
      installBtn.addEventListener("click", async () => {
        // iOS non supporta beforeinstallprompt: mostro istruzioni
        const isIos = /iphone|ipad|ipod/i.test(navigator.userAgent);
        const isInStandalone = window.matchMedia("(display-mode: standalone)").matches
          || window.navigator.standalone === true;

        if (isIos && !deferredPrompt) {
          alert("Per installare l'app ANTARES II su iPhone/iPad:\n\n1. Tocca il pulsante Condividi (icona quadrato con freccia verso l'alto).\n2. Seleziona 'Aggiungi alla schermata Home'.\n3. Conferma il nome e premi 'Aggiungi'.");
          return;
        }

        if (!deferredPrompt) {
          // Nessun evento disponibile (es. desktop già installato): non faccio nulla o mostro info
          alert("Per installare l'app ANTARES II sul tuo dispositivo:\n\n- Su Chrome/Edge: apri il menu (⋮ o ⋯) e scegli 'Installa app' o 'Installa ANTARES II'.\n- Su Windows: in Chrome/Edge trovi la voce 'Installa app' vicino alla barra degli indirizzi.");
          return;
        }

        deferredPrompt.prompt();
        try {
          const choiceResult = await deferredPrompt.userChoice;
          console.log("User choice:", choiceResult.outcome);
        } catch (err) {
          console.error(err);
        }
        deferredPrompt = null;
        installBtn.style.display = "none";
      });
    }

    // Service worker registration (necessario per l'installazione come PWA)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker.register("./service-worker.js").catch(() => {});
      });
    }
  </script>


  
</body>
</html>
